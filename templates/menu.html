<!-- templates/core/menu.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–µ–Ω—é | ECHO Corp.</title>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'core/css/menu.css' %}">
</head>
<body>
    <div class="header">
        <span class="header-title">ECHO Corp.</span>
        <a href="{% url 'profile' %}" class="profile-button">üë§</a>
    </div>

    <div class="full-screen-menu">
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫...">
            <button class="search-btn">üîç</button>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                <ul id="category-list">
                </ul>
            </div>

            <div class="content-area">
                <div class="menu-grid" id="dish-grid">
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentCategoryId = null;

        function selectCategory(categoryId, categoryName) {
            const categoryItems = document.querySelectorAll("#category-list li");
            categoryItems.forEach(item => item.classList.remove('selected'));

            const selectedItem = Array.from(categoryItems).find(item => item.dataset.categoryId === categoryId);
            if (selectedItem) {
                selectedItem.classList.add('selected');
            }

            currentCategoryId = categoryId;
            loadDishes(categoryId, categoryName);
        }

        function loadDishes(categoryId = null, categoryName = '') {
            const dishGrid = document.getElementById("dish-grid");
            dishGrid.innerHTML = '';

            if (categoryId && categoryId !== 'all') {
                dishGrid.innerHTML = `<p>–ó–∞–≥—Ä—É–∑–∫–∞ –±–ª—é–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "${categoryName}"...</p>`;
                const filteredDishes = allDishes.filter(dish => dish.categoryId == categoryId);
                renderDishes(filteredDishes);
            } else {
                dishGrid.innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –±–ª—é–¥...</p>';
                renderDishes(allDishes);
            }
        }

        function renderDishes(dishes) {
            const dishGrid = document.getElementById("dish-grid");
            dishGrid.innerHTML = '';
            if (dishes.length === 0) {
                dishGrid.innerHTML = '<p>–ù–µ—Ç –±–ª—é–¥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>';
            } else {
                dishes.forEach(dish => {
                    const dishCardLink = document.createElement('a');
                    dishCardLink.href = "{% url 'dish_detail' 0 %}".replace('0', dish.id);
                    dishCardLink.className = 'dish-card-link';

                    const card = document.createElement('div');
                    card.className = 'dish-card';

                    const img = document.createElement('img');
                    img.src = dish.image;
                    img.alt = dish.name;
                    img.className = 'dish-image';

                    const info = document.createElement('div');
                    info.className = 'dish-info';

                    const name = document.createElement('h3');
                    name.className = 'dish-name';
                    name.textContent = dish.name;

                    const price = document.createElement('p');
                    price.className = 'dish-price';
                    price.textContent = `${dish.price}‚ÇΩ`;

                    info.appendChild(name);
                    info.appendChild(price);

                    card.appendChild(img);
                    card.appendChild(info);

                    dishCardLink.appendChild(card);
                    dishGrid.appendChild(dishCardLink);
                });
            }
        }

        const allDishes = [
            {% for dish in dishes %}
                {
                    id: {{ dish.id }},
                    name: "{{ dish.name|escapejs }}",
                    price: {{ dish.price }},
                    image: "{{ dish.image.url|escapejs }}",
                    categoryId: {{ dish.category.id }}
                },
            {% endfor %}
        ];

        const allCategories = [
            {% for cat in categories %}
                { id: {{ cat.id }}, name: "{{ cat.name|escapejs }}" },
            {% endfor %}
        ];

        document.addEventListener('DOMContentLoaded', function() {
            const categoryList = document.getElementById("category-list");

            const allLi = document.createElement("li");
            allLi.innerHTML = `<span>–í—Å–µ</span>`;
            allLi.dataset.categoryId = "all";
            allLi.dataset.categoryName = "–í—Å–µ";
            allLi.addEventListener('click', function() {
                selectCategory(this.dataset.categoryId, this.dataset.categoryName);
            });
            categoryList.appendChild(allLi);

            allCategories.forEach(cat => {
                const li = document.createElement("li");
                li.innerHTML = `<span>${cat.name}</span>`;
                li.dataset.categoryId = cat.id;
                li.dataset.categoryName = cat.name;
                li.addEventListener('click', function() {
                    selectCategory(this.dataset.categoryId, this.dataset.categoryName);
                });
                categoryList.appendChild(li);
            });

            selectCategory("all", "–í—Å–µ");
        });
    </script>
</body>
</html>