<!-- templates/admin_dish_detail.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{{ dish.name }} | ECHO Corp.</title>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'core/css/admin_dish_detail.css' %}">
</head>
<body>
    <div class="header">
        <span class="header-title">ECHO Corp.</span>
        <div class="header-buttons">
            <a href="{% url 'profile' %}" class="profile-button user-icon">üë§</a>
            <a href="{% url 'admin:index' %}" class="profile-button admin-icon">‚öôÔ∏è</a>
        </div>
    </div>
    <div class="full-screen-menu">
        <a href="{{ previous_url }}" class="back-button">–ù–∞–∑–∞–¥</a>

        <div class="dish-detail-card">
            <div class="dish-header">
                <h2 class="dish-name">{{ dish.name }}</h2>
                <button id="save-dish-button" class="save-button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>

            <div class="image-container">
                <img src="{{ dish.image }}" alt="{{ dish.name }}" class="dish-image">
            </div>

            <div class="dish-content">
                <input type="text" id="dish-name-input" class="dish-name-input" value="{{ dish.name }}" placeholder="–ò–º—è –±–ª—é–¥–∞">

                <textarea id="dish-description-input" class="dish-description-input" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –±–ª—é–¥–∞">{{ dish.description }}</textarea>

                <div class="price-container">
                    <label for="dish-price">–¶–µ–Ω–∞:</label>
                    <input type="number" id="dish-price-input" class="dish-price-input" value="{{ dish.price }}" step="0.01" placeholder="–¶–µ–Ω–∞">
                </div>

                <div class="action-buttons">
                    <form method="post" action="{% url 'add_to_cart' %}">
                        {% csrf_token %}
                        <input type="hidden" name="dish_id" value="{{ dish.id }}">
                        <input type="hidden" name="dish_name" value="{{ dish.name }}">
                        <input type="hidden" name="dish_price" value="{{ dish.price }}">
                        <input type="hidden" name="dish_image" value="{{ dish.image }}">

                        <div class="quantity-controls">
                            <label for="quantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                            <input type="number" id="quantity" name="quantity" value="1" min="1" class="quantity-input">
                        </div>

                        <button type="submit" class="add-button">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        const saveButton = document.getElementById('save-dish-button');

        saveButton.addEventListener('click', function() {
            const dishId = {{ dish.id }};
            const newName = document.getElementById('dish-name-input').value;
            const newDescription = document.getElementById('dish-description-input').value;
            const newPrice = parseFloat(document.getElementById('dish-price-input').value);

            if (isNaN(newPrice) || newName.trim() === '') {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–º—è –∏ —Ü–µ–Ω—É.');
                return;
            }

            const postData = {
                'dish_id': dishId,
                'name': newName,
                'description': newDescription,
                'price': newPrice,
                'csrfmiddlewaretoken': document.querySelector('[name=csrfmiddlewaretoken]').value
            };

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º URL, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª –≤ JavaScript –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
            // –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º –µ–≥–æ —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω–Ω—ã–π —Ç–µ–≥ Django, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å –≤ admin_dish_detail_view
            // –ù–æ —Ç–∞–∫ –∫–∞–∫ –º—ã –µ–≥–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º —à–∞–±–ª–æ–Ω–Ω—ã–π —Ç–µ–≥ –∑–¥–µ—Å—å:
            const updateUrl = '{% url "update_dish" dish.id %}';

            fetch(updateUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(postData)
            })
            .then(response => {
                if (response.ok) {
                    // –£—Å–ø–µ—à–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ - —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –º–µ–Ω—é
                    window.location.href = '{% url "admin_menu" %}'; // –ò—Å–ø–æ–ª—å–∑—É–µ–º —à–∞–±–ª–æ–Ω–Ω—ã–π —Ç–µ–≥ –¥–ª—è URL –º–µ–Ω—é
                } else {
                    response.text().then(text => {
                        console.error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', text);
                        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–ª—é–¥–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.');
                    });
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–µ—Ä—É.');
            });
        });
    </script>
</body>
</html>