<!-- templates/core/admin_panel.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | ECHO Corp.</title>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'core/css/a_admin.css' %}?v=4">
</head>
<body>
    <div class="header">
        <span class="header-title">ECHO Corp.</span>
        <div class="header-buttons">
            <a href="{% url 'admin_logout' %}" class="profile-button">üö™</a>
            <a href="{% url 'admin_calendar' %}" class="profile-button">üìÖ</a>
            <span class="unused-button">üìã</span>
        </div>
    </div>

    <div class="main-content">
        <div class="container">
            <h2 class="panel-title">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>

            <div class="toggle-group">
                <label class="toggle-label">
                    <div class="toggle-switch">
                        <input type="checkbox" id="work-dates-toggle" {% if work_dates_enabled %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </div>
                    <span>–î–∞—Ç—ã —Ä–∞–±–æ—Ç</span>
                </label>
                <div class="date-inputs">
                    <input type="text" id="date-from" placeholder="—Å" size="5" value="{{ date_from }}" {% if not work_dates_enabled %}readonly{% endif %}>
                    <span>–ø–æ</span>
                    <input type="text" id="date-to" placeholder="–ø–æ" size="5" value="{{ date_to }}" {% if not work_dates_enabled %}readonly{% endif %}>
                </div>
            </div>

            <div class="toggle-group">
                <label class="toggle-label">
                    <div class="toggle-switch">
                        <input type="checkbox" id="block-toggle" {% if block_enabled %}checked{% endif %}>
                        <span class="toggle-slider"></span>
                    </div>
                    <span>–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞</span>
                </label>
            </div>

            <div style="margin-top: 30px;">
                <a href="{% url 'admin_clients' %}" class="panel-button">–ö–ª–∏–µ–Ω—Ç—ã</a>
                <a href="{% url 'admin_menu' %}" class="panel-button">–†–µ–¥. –ø–æ–∑–∏—Ü–∏–∏</a>
                <a href="{% url 'admin_orders_tomorrow' %}" class="panel-button">–ó–∞–∫–∞–∑—ã –Ω–∞ –∑–∞–≤—Ç—Ä–∞</a>
                <a href="{% url 'admin_orders_today' %}" class="panel-button">–ó–∞–∫–∞–∑—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</a>
            </div>
        </div>
    </div>

    <script>
        const workDatesToggle = document.getElementById('work-dates-toggle');
        const blockToggle = document.getElementById('block-toggle');
        const dateFrom = document.getElementById('date-from');
        const dateTo = document.getElementById('date-to');

        workDatesToggle.addEventListener('change', function() {
            const isEnabled = this.checked;
            dateFrom.readOnly = !isEnabled;
            dateTo.readOnly = !isEnabled;

            if (!isEnabled) {
                dateFrom.value = '';
                dateTo.value = '';
            }

            saveSettings();
        });

        blockToggle.addEventListener('change', saveSettings);

        dateFrom.addEventListener('change', saveSettings);
        dateTo.addEventListener('change', saveSettings);

        dateFrom.addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9.]/g, '');
        });

        dateTo.addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9.]/g, '');
        });

        function saveSettings() {
            const formData = new FormData();
            formData.append('work_dates_enabled', workDatesToggle.checked);
            formData.append('date_from', dateFrom.value);
            formData.append('date_to', dateTo.value);
            formData.append('block_enabled', blockToggle.checked);

            fetch('/admin/settings/save/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫:', data.error);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
            });
        }

        let saveTimeout;
        function debounceSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(saveSettings, 1000);
        }

        dateFrom.addEventListener('input', debounceSave);
        dateTo.addEventListener('input', debounceSave);
    </script>
</body>
</html>