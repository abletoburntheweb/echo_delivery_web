<!-- templates/core/admin_orders_by_date.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>{{ title }} | ECHO Corp.</title>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'core/css/a_admin.css' %}">
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            color: white;
            position: relative;
            max-width: 600px;
            width: 90%;
        }

        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #bdc3c7;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="header">
        <span class="header-title">ECHO Corp.</span>
        <div class="header-buttons">
            <a href="{% url 'admin_logout' %}" class="profile-button">üö™</a>
            <a href="{% url 'admin_calendar' %}" class="unused-button">üìÖ</a>
            <a href="{% url 'admin_panel' %}" class="profile-button">üìã</a>
        </div>
    </div>

    <div class="main-content">
        <div class="container clients-container">
            <h2 class="panel-title">{{ title }}</h2>

            {% if orders %}
                <div style="margin-top: 20px; overflow-x: auto;">
                    <table style="width: 100%; min-width: 900px; border-collapse: collapse; color: white; background-color: #2c3e50; border-radius: 10px; overflow: hidden;">
                        <thead>
                            <tr style="background-color: #34495e; font-weight: bold;">
                                <th style="padding: 12px; text-align: center;">–ö–æ–¥</th>
                                <th style="padding: 12px; text-align: center;">–§–∏—Ä–º–∞</th>
                                <th style="padding: 12px; text-align: center;">–ê–¥—Ä–µ—Å</th>
                                <th style="padding: 12px; text-align: center;">–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th style="padding: 12px; text-align: center;">–°—É–º–º–∞</th>
                                <th style="padding: 12px; text-align: center;">–í—Ä–µ–º—è</th>
                                <th style="padding: 12px; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                                <tr style="border-bottom: 1px solid #34495e;">
                                    <td style="padding: 12px; text-align: center;">{{ order.id|default:"‚Äî" }}</td>
                                    <td style="padding: 12px;">
                                        <a href="{% url 'admin_client_orders' order.company_id %}"
                                           style="color: white; text-decoration: underline; cursor: pointer;">
                                            {{ order.company|default:"‚Äî" }}
                                        </a>
                                    </td>
                                    <td style="padding: 12px;">{{ order.address|default:"‚Äî" }}</td>
                                    <td style="padding: 12px; text-align: center;">{{ order.phone|default:"‚Äî" }}</td>
                                    <td style="padding: 12px; text-align: center;">{{ order.amount|default:"0" }}‚ÇΩ</td>
                                    <td style="padding: 12px; text-align: center;">{{ order.time|default:"‚Äî" }}</td>
                                    <td style="padding: 12px; text-align: center;">
                                        <div class="action-buttons">
                                            <button type="button" style="background: none; border: none; cursor: pointer; color: #3498db; font-size: 18px;"
                                                    onclick="showOrderDetails({{ order.id }})" title="–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞">
                                                üîç
                                            </button>

                                            <form method="post" action="{% url 'admin_delete_order' order.id %}" style="display: inline;">
                                                {% csrf_token %}
                                                <button type="submit" style="background: none; border: none; cursor: pointer; color: #e74c3c; font-size: 18px;"
                                                        onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑ ‚Ññ{{ order.id }}?')">
                                                    üóëÔ∏è
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p style="color: #666; text-align: center; margin-top: 20px;">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É</p>
            {% endif %}

            <div id="orderDetailsModal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeOrderDetails()">&times;</span>
                    <h3>–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞ #<span id="modalOrderId"></span></h3>

                    <div id="orderDetailsContent">
                    </div>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <a href="{% url 'admin_panel' %}" class="panel-button">–ù–∞–∑–∞–¥ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</a>
            </div>
        </div>
    </div>

    <script>
    function showOrderDetails(orderId) {
        document.getElementById('orderDetailsModal').style.display = 'flex';
        document.getElementById('modalOrderId').textContent = orderId;

        document.getElementById('orderDetailsContent').innerHTML = `
            <div style="text-align: center; padding: 20px;">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
        `;

        fetch(`/admin/order/${orderId}/details/`)
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    let content = `
                        <div style="margin-bottom: 15px; background: #34495e; padding: 15px; border-radius: 8px;">
                            <strong>–ö–æ–º–ø–∞–Ω–∏—è:</strong> ${data.company}<br>
                            <strong>–î–∞—Ç–∞:</strong> ${data.delivery_date}<br>
                            <strong>–í—Ä–µ–º—è:</strong> ${data.delivery_time}<br>
                            <strong>–ê–¥—Ä–µ—Å:</strong> ${data.address}
                        </div>
                        <div style="background: white; color: #2c3e50; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <h4 style="margin-top: 0; color: #2c3e50; text-align: center;">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</h4>
                    `;

                    data.items.forEach(item => {
                        content += `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee;">
                                <div>
                                    <strong>${item.name}</strong><br>
                                    <small>${item.price}‚ÇΩ √ó ${item.quantity}</small>
                                </div>
                                <strong>${item.total}‚ÇΩ</strong>
                            </div>
                        `;
                    });

                    content += `
                            <div style="display: flex; justify-content: space-between; padding: 12px 0; font-weight: bold; border-top: 2px solid #2c3e50; margin-top: 10px;">
                                <span>–ò—Ç–æ–≥–æ:</span>
                                <span>${data.total}‚ÇΩ</span>
                            </div>
                        </div>
                    `;

                    document.getElementById('orderDetailsContent').innerHTML = content;
                } else {
                    document.getElementById('orderDetailsContent').innerHTML = `
                        <div style="color: #e74c3c; text-align: center; padding: 20px;">
                            –û—à–∏–±–∫–∞: ${data.error}
                        </div>
                    `;
                }
            })
            .catch(error => {
                document.getElementById('orderDetailsContent').innerHTML = `
                    <div style="color: #e74c3c; text-align: center; padding: 20px;">
                        –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                    </div>
                `;
            });
    }

    function closeOrderDetails() {
        document.getElementById('orderDetailsModal').style.display = 'none';
    }

    window.addEventListener('click', function(e) {
        const modal = document.getElementById('orderDetailsModal');
        if (e.target === modal) {
            closeOrderDetails();
        }
    });
    </script>
</body>
</html>