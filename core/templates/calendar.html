<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞–ª–µ–Ω–¥–∞—Ä—å | ECHO Corp.</title>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'core/css/calendar.css' %}">
</head>
<body>
    <div class="header">
    <span class="header-title">ECHO Corp.</span>
    <a href="{% url 'profile' %}" class="profile-button">üë§</a>
</div>
    <div class="main-content">
        <div class="container">
            <div class="calendar-header">
    <h2 class="month-header">{{ month_name|capfirst }}</h2>
    <a href="{% url 'faq' %}" class="faq-button">FAQ</a>
</div>
            <div class="weekdays-grid">
                <div class="weekday">–ü–Ω</div>
                <div class="weekday">–í—Ç</div>
                <div class="weekday">–°—Ä</div>
                <div class="weekday">–ß—Ç</div>
                <div class="weekday">–ü—Ç</div>
                <div class="weekday">–°–±</div>
                <div class="weekday">–í—Å</div>
            </div>
            <div class="calendar-grid">
                {% for i in "0123456"|make_list %}
                    {% if i|add:"0" < days.0.weekday %}
                        <div class="empty-cell"></div>
                    {% endif %}
                {% endfor %}
                {% for day_info in days %}
                    <div class="day-btn{% if day_info.is_today %} selected{% endif %}" data-date="{{ day_info.date|date:'Y-m-d' }}">{{ day_info.date.day }}</div>
                {% endfor %}
            </div>
            <form id="calendar-form" method="post">
                {% csrf_token %}
                <input type="hidden" id="selected-date" name="selected_date" value="">
                <button class="accept-button" type="submit" onclick="window.location.href='{% url 'cart' %}'; return false;">–ü—Ä–∏–Ω—è—Ç—å</button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dayButtons = document.querySelectorAll('.day-btn');
            const selectedDateInput = document.getElementById('selected-date');
            let selectedButton = null;

            function selectDay(button) {
                // –°–Ω–∏–º–∞–µ–º –∫–ª–∞—Å—Å selected —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                if (selectedButton) {
                    selectedButton.classList.remove('selected');
                }

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å selected –∫ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
                button.classList.add('selected');
                selectedButton = button;

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –≤ —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ —Ñ–æ—Ä–º—ã
                const dateValue = button.getAttribute('data-date');
                selectedDateInput.value = dateValue;
                console.log('–í—ã–±—Ä–∞–Ω–∞ –¥–∞—Ç–∞:', dateValue); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
            }

            dayButtons.forEach(button => {
                button.addEventListener('click', function() {
                    selectDay(this);
                });
            });

            if (selectedDateInput.value) {
                // –ï—Å–ª–∏ –µ—Å—Ç—å, –Ω–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É –∏ "–≤—ã–±–∏—Ä–∞–µ–º" –µ—ë
                const previouslySelectedButton = document.querySelector(`.day-btn[data-date="${selectedDateInput.value}"]`);
                if (previouslySelectedButton) {
                    selectDay(previouslySelectedButton);
                }
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Ç, –∏—â–µ–º –∫–Ω–æ–ø–∫—É —Å –∫–ª–∞—Å—Å–æ–º 'selected' (—ç—Ç–æ –±—É–¥–µ—Ç —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å, –µ—Å–ª–∏ –æ–Ω –ø–æ–¥—Å–≤–µ—á–µ–Ω —Å–µ—Ä–≤–µ—Ä–æ–º)
                const todayButton = document.querySelector('.day-btn.selected');
                if (todayButton) {
                    // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å 'selected', —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ç–∏–ª—è
                    todayButton.classList.remove('selected');
                    // –í—ã–±–∏—Ä–∞–µ–º –µ—ë –∫–∞–∫ "–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"
                    selectDay(todayButton);
                }
            }
        });
    </script>
</body>
</html>